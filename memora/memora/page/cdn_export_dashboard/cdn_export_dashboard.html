<div class="page-head">
  <h1>CDN Export Dashboard</h1>
  <p class="text-muted">Monitor CDN content export operations and manage sync queue</p>
</div>

<div class="page-content">
  <div class="row">
    <!-- Queue Status Card -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h4>Pending Plans</h4>
          <h2 id="pending-count" class="text-info">0</h2>
          <p class="text-muted">Plans waiting to sync</p>
        </div>
      </div>
    </div>

    <!-- Dead Letter Card -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h4>Dead Letter Queue</h4>
          <h2 id="dead-letter-count" class="text-danger">0</h2>
          <p class="text-muted">Failed items after retries</p>
        </div>
      </div>
    </div>

    <!-- Last Processed Card -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h4>Last Processed</h4>
          <p id="last-processed" class="text-muted">--</p>
        </div>
      </div>
    </div>

    <!-- Refresh Button -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-body text-center">
          <button class="btn btn-primary" id="refresh-btn">
            <i class="icon-refresh"></i> Refresh
          </button>
          <br><br>
          <small class="text-muted">Auto-refresh: 30s</small>
        </div>
      </div>
    </div>
  </div>

  <hr>

  <!-- Recent Failures Section -->
  <div class="row">
    <div class="col-md-12">
      <h3>Recent Failures (Last 7 Days)</h3>
      <div id="failures-container">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Status</th>
              <th>Retries</th>
              <th>Error Message</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="failures-tbody">
            <tr>
              <td colspan="6" class="text-center text-muted">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <hr>

  <!-- Dead Letter Items Section -->
  <div class="row">
    <div class="col-md-12">
      <h3>Dead Letter Queue</h3>
      <div class="btn-group" role="group">
        <button class="btn btn-sm btn-warning" id="retry-all-btn">
          <i class="icon-refresh"></i> Retry All
        </button>
        <button class="btn btn-sm btn-danger" id="clear-dead-letter-btn">
          <i class="icon-trash"></i> Clear All
        </button>
      </div>
      <div id="dead-letter-container" style="margin-top: 15px;">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Sync Log</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="dead-letter-tbody">
            <tr>
              <td colspan="4" class="text-center text-muted">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <hr>

  <!-- Sync History Section -->
  <div class="row">
    <div class="col-md-12">
      <h3>Recent Sync History</h3>
      <div>
        <label>Filter by Plan:</label>
        <input type="text" id="plan-filter" class="form-control" style="width: 300px;" placeholder="Leave blank for all plans">
        <button class="btn btn-sm btn-default" id="filter-history-btn" style="margin-top: 10px;">
          <i class="icon-filter"></i> Filter
        </button>
      </div>
      <div id="history-container" style="margin-top: 15px;">
        <table class="table table-striped table-hover table-sm">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Status</th>
              <th>Started</th>
              <th>Completed</th>
              <th>Files Uploaded</th>
              <th>Triggered By</th>
            </tr>
          </thead>
          <tbody id="history-tbody">
            <tr>
              <td colspan="6" class="text-center text-muted">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
.card {
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-bottom: 20px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.card-body {
  padding: 20px;
}

.text-info {
  color: #0275d8;
}

.text-danger {
  color: #d9534f;
}

.text-muted {
  color: #999;
}

#pending-count, #dead-letter-count {
  margin: 10px 0;
  font-weight: bold;
}

.table-hover tbody tr:hover {
  background-color: #f5f5f5;
}
</style>
